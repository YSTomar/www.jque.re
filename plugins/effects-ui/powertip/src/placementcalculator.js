function PlacementCalculator(){function getHtmlPlacement(element,placement){var objectOffset=element.offset(),objectWidth=element.outerWidth(),objectHeight=element.outerHeight(),left,top;switch(placement){case"n":left=objectOffset.left+objectWidth/2;top=objectOffset.top;break;case"e":left=objectOffset.left+objectWidth;top=objectOffset.top+objectHeight/2;break;case"s":left=objectOffset.left+objectWidth/2;top=objectOffset.top+objectHeight;break;case"w":left=objectOffset.left;top=objectOffset.top+objectHeight/2;break;case"nw":left=objectOffset.left;top=objectOffset.top;break;case"ne":left=objectOffset.left+objectWidth;top=objectOffset.top;break;case"sw":left=objectOffset.left;top=objectOffset.top+objectHeight;break;case"se":left=objectOffset.left+objectWidth;top=objectOffset.top+objectHeight;break;}return{top:top,left:left};}function getSvgPlacement(element,placement){var svgElement=element.closest("svg")[0],domElement=element[0],point=svgElement.createSVGPoint(),boundingBox=domElement.getBBox(),matrix=domElement.getScreenCTM(),halfWidth=boundingBox.width/2,halfHeight=boundingBox.height/2,placements=[],placementKeys=["nw","n","ne","e","se","s","sw","w"],coords,rotation,steps,x;function pushPlacement(){placements.push(point.matrixTransform(matrix));}point.x=boundingBox.x;point.y=boundingBox.y;pushPlacement();point.x+=halfWidth;pushPlacement();point.x+=halfWidth;pushPlacement();point.y+=halfHeight;pushPlacement();point.y+=halfHeight;pushPlacement();point.x-=halfWidth;pushPlacement();point.x-=halfWidth;pushPlacement();point.y-=halfHeight;pushPlacement();if(placements[0].y!==placements[1].y||placements[0].x!==placements[7].x){rotation=Math.atan2(matrix.b,matrix.a)*RAD2DEG;steps=Math.ceil(((rotation%360)-22.5)/45);if(steps<1){steps+=8;}while(steps--){placementKeys.push(placementKeys.shift());}}for(x=0;x<placements.length;x++){if(placementKeys[x]===placement){coords=placements[x];break;}}return{top:coords.y+$window.scrollTop(),left:coords.x+$window.scrollLeft()};}function computePlacementCoords(element,placement,tipWidth,tipHeight,offset){var placementBase=placement.split("-")[0],coords=new CSSCordinate(),position;if(isSvgElement(element)){position=getSvgPlacement(element,placementBase);}else{position=getHtmlPlacement(element,placementBase);}switch(placement){case"n":coords.set("left",position.left-(tipWidth/2));coords.set("top",position.top-tipHeight-offset);break;case"e":coords.set("left",position.left+offset);coords.set("top",position.top-(tipHeight/2));break;case"s":coords.set("left",position.left-(tipWidth/2));coords.set("top",position.top+offset);break;case"w":coords.set("top",position.top-(tipHeight/2));coords.set("right",$window.width()-position.left+offset);break;case"nw":coords.set("top",position.top-tipHeight-offset);coords.set("right",$window.width()-position.left-20);break;case"nw-alt":coords.set("left",position.left);coords.set("top",position.top-tipHeight-offset);break;case"ne":coords.set("left",position.left-20);coords.set("top",position.top-tipHeight-offset);break;case"ne-alt":coords.set("top",position.top-tipHeight-offset);coords.set("right",$window.width()-position.left);break;case"sw":coords.set("top",position.top+offset);coords.set("right",$window.width()-position.left-20);break;case"sw-alt":coords.set("left",position.left);coords.set("top",position.top+offset);break;case"se":coords.set("left",position.left-20);coords.set("top",position.top+offset);break;case"se-alt":coords.set("top",position.top+offset);coords.set("right",$window.width()-position.left);break;}return coords;}this.compute=computePlacementCoords;}