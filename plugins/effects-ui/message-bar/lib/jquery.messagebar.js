(function($){var settings={background_color:"#003B62",position:"top",content_class:"messagebar-content-default",content_id:"messagebar-content",shadow:true,close_button:false,close_on_click:true,message_types:{info:{barClass:"messagebar-info",contentClass:"messagebar-content-info"},error:{barClass:"messagebar-error",contentClass:"messagebar-content-error"}}};var api={init:function(options){return this.each(function(){var opts=$.extend({},settings,options);var $this=$(this),data=$this.data("messagebar");if(!data){var bar=createBar(opts),content=createContent(opts),navigation=createNavigation(opts),closebutton=createCloseButton(opts),upArrow=$("div",navigation).first(),downArrow=$("div",navigation).last();if(opts.close_on_click==true){bar.bind("click.messagebar",{plugin:$this},handleMessageBarClick);bar.css("cursor","pointer")}upArrow.bind("click.messagebar",{plugin:$this},handleNavigationUpClick);downArrow.bind("click.messagebar",{plugin:$this},handleNavigationDownClick);$this.prepend(bar);bar.append(closebutton).append(navigation).append(content);$this.data("messagebar",{messages:[],index:0,opts:opts,showing:false})}})},isShowing:function(){var data=this.data("messagebar");if(data&&typeof(data.showing)==="boolean"){return data.showing}return false},show:function(){return this.each(function(){var data=$(this).data("messagebar");var bar=$(".messagebar",this),content=$("#"+data.opts.content_id,this),upArrow=$(".messagebar-navigation div",this).first(),downArrow=$(".messagebar-navigation div",this).last(),msgCount=data.messages.length;hideArrow(upArrow);if(msgCount>0){(msgCount>1?showArrow(downArrow):hideArrow(downArrow));displayMessage(data.messages[data.index],data.opts,this,bar,content)}else{hideArrow(downArrow);restoreBarStyle(this,data.opts);restoreContentStyle(this,data.opts);content.text("")}if(!data.showing){bar.fadeIn("fast");data.showing=true}})},hide:function(clearMessages){return this.each(function(){var $this=$(this),data=$this.data("messagebar");if(clearMessages===true){$this.messagebar("clearMessages")}if(data.showing){$(".messagebar",this).fadeOut("fast");data.showing=false}})},addMessage:function(message,type){return this.each(function(){var $this=$(this),data=$this.data("messagebar");data.messages.unshift(createMessage(message,type));data.index=0})},clearMessages:function(){return this.each(function(){$(this).data("messagebar").messages.length=0})},showNext:function(){return this.each(function(){var $this=$(this),data=$this.data("messagebar"),messages=data.messages,msgCount=messages.length,index=data.index,bar=$(".messagebar",this),content=$("#"+data.opts.content_id,this),upArrow=$(".messagebar-navigation div",this).first(),downArrow=$(".messagebar-navigation div",this).last();if(index<(msgCount-1)){showArrow(upArrow);index+=1;displayMessage(messages[index],data.opts,this,bar,content);data.index=index;if(index===(msgCount-1)){hideArrow(downArrow)}}})},showPrevious:function(){return this.each(function(){var $this=$(this),data=$this.data("messagebar"),messages=data.messages,msgCount=messages.length,index=data.index,bar=$(".messagebar",this),content=$("#"+data.opts.content_id,this),upArrow=$(".messagebar-navigation div",this).first(),downArrow=$(".messagebar-navigation div",this).last();if(index>0){showArrow(downArrow);index-=1;displayMessage(messages[index],data.opts,this,bar,content);data.index=index;if(index===0){hideArrow(upArrow)}}})}};var createBar=function(settings){return setBarDefaultStyle($("<div />"),settings)};var setBarDefaultStyle=function(barEl,settings){var classes=["messagebar","messagebar-"+settings.position,settings.content_class];if(settings.shadow&&settings.position=="top"){classes.push("messagebar-shadow")}return barEl.attr("class",classes.join(" ")).css({"background-color":settings.background_color})};var restoreBarStyle=function(pluginEl,settings){setBarDefaultStyle($(".messagebar",pluginEl),settings)};var createContent=function(settings){return setContentDefaultStyle($("<div />").attr("id",settings.content_id),settings)};var setContentDefaultStyle=function(contentEl,settings){return contentEl.attr("class","messagebar-content "+settings.content_class)};var restoreContentStyle=function(pluginEl,settings){setContentDefaultStyle($("#"+settings.content_id,pluginEl),settings)};var createNavigation=function(settings){var container=$("<div />");container.addClass("messagebar-navigation messagebar-navigation-"+settings.position);container.append('<div class="messagebar-arrow-up" />').append('<div class="messagebar-arrow-down" />');return container};var createCloseButton=function(settings){if(settings.close_button==true){var container=$("<div>");container.addClass("messagebar-close-button");container.append('<div id="close_messagebar">X</div>');return container}};var createMessage=function(message,messageType){return(function(){var msg=message,type=messageType;return{content:function(){return msg},type:function(){return type}}})()};var displayMessage=function(message,settings,jqPluginEl,jqBarEl,jqContentEl){restoreBarStyle(jqPluginEl,settings);restoreContentStyle(jqPluginEl,settings);if(settings.message_types[message.type()]){var msg_type_config=settings.message_types[message.type()],barClass=msg_type_config.barClass,contentClass=msg_type_config.contentClass;jqBarEl.addClass(barClass);jqContentEl.addClass(contentClass)}jqContentEl.html(message.content())};var _toggleArrow=function(arrow,up,hide){if(arrow){var base="messagebar-arrow-"+(up?"up":"down");if(hide){arrow.attr("class",base+" "+base+"-hidden")}else{arrow.attr("class",base)}}};var showArrow=function(arrow){var isUpArrow=!!arrow.attr("class").match(/up/i);_toggleArrow(arrow,isUpArrow,false)};var hideArrow=function(arrow){var isUpArrow=!!arrow.attr("class").match(/up/i);_toggleArrow(arrow,isUpArrow,true)};var handleMessageBarClick=function(event){var plugin=event.data.plugin;$(plugin).messagebar("hide",true)};var handleNavigationUpClick=function(event){event.stopPropagation();if($(event.target).attr("class").match(/hidden/i)){return}var plugin=event.data.plugin;$(plugin).messagebar("showPrevious")};var handleNavigationDownClick=function(event){event.stopPropagation();if($(event.target).attr("class").match(/hidden/i)){return}var plugin=event.data.plugin;$(plugin).messagebar("showNext")};$.fn.messagebar=function(method){if(api[method]){return api[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return api.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.messagebar")}}}})(jQuery);