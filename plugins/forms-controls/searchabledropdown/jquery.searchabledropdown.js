(function($){var plugin=register("searchable");plugin.defaults={maxListSize:100,maxMultiMatch:50,exactMatch:false,wildcards:true,ignoreCase:true,warnMultiMatch:"top {0} matches ...",warnNoMatch:"no matches ...",latency:200,zIndex:"auto"};plugin.execute=function(settings,zindex){if($.browser.msie&&parseInt(jQuery.browser.version)<7){return this;}if(this.nodeName!="SELECT"||this.size>1){return this;}var self=$(this);var storage={index:-1,options:null};var idxAttr="lang";var enabled=false;$.browser.chrome=/chrome/.test(navigator.userAgent.toLowerCase());if($.browser.chrome){$.browser.safari=false;}if($.meta){settings=$.extend({},options,self.data());}var wrapper=$("<div/>");var overlay=$("<div/>");var input=$("<input/>");var selector=$("<select/>");var topMatchItem=$("<option>"+settings.warnMultiMatch.replace(/\{0\}/g,settings.maxMultiMatch)+"</option>").attr("disabled","true");var noMatchItem=$("<option>"+settings.warnNoMatch+"</option>").attr("disabled","true");var selectorHelper={option:function(idx){return $(selector.get(0).options[idx]);},selected:function(){return selector.find(":selected");},selectedIndex:function(idx){if(idx>-1){selector.get(0).selectedIndex=idx;}return selector.get(0).selectedIndex;},size:function(size){selector.attr("size",Math.max(2,Math.min(size,20)));},reset:function(){if((self.get(0).selectedIndex-1)==self.data("index")){return;}var idx=self.get(0).selectedIndex;var len=self.get(0).length;var mc=Math.floor(settings.maxMultiMatch/2);var begin=Math.max(1,(idx-mc));var end=Math.min(len,Math.max(settings.maxMultiMatch,(idx+mc)));var si=idx-begin;selector.empty();selectorHelper.size(end-begin);for(var i=begin;i<end;i++){selector.append($(self.get(0).options[i]).clone().attr(idxAttr,i-1));}if(end>settings.maxMultiMatch){selector.append(topMatchItem);}selector.get(0).selectedIndex=si;}};draw();var suspendBlur=false;overlay.mouseover(function(){suspendBlur=true;});overlay.mouseout(function(){suspendBlur=false;});selector.mouseover(function(){suspendBlur=true;});selector.mouseout(function(){suspendBlur=false;});input.click(function(e){if(!enabled){enable(e,true);}else{disable(e,true);}});input.blur(function(e){if(!suspendBlur&&enabled){disable(e,true);}});self.keydown(function(e){if(e.keyCode!=9){enable(e,false,true);}});self.click(function(e){selector.focus();});selector.click(function(e){if(selectorHelper.selectedIndex()<0){return;}disable(e);});selector.focus(function(e){input.focus();});selector.blur(function(e){if(!suspendBlur){disable(e,true);}});selector.mousemove(function(e){if($.browser.opera&&parseFloat(jQuery.browser.version)>=9.8){return true;}var fs=Math.floor(parseFloat(/([0-9\.]+)px/.exec(selectorHelper.option(0).css("font-size"))));var fsdiff=4;if($.browser.opera){fsdiff=2.5;}if($.browser.safari||$.browser.chrome){fsdiff=3;}fs+=Math.round(fs/fsdiff);selectorHelper.selectedIndex(Math.floor((e.pageY-selector.offset().top+this.scrollTop)/fs));});overlay.click(function(e){input.click();});input.keyup(function(e){if(jQuery.inArray(e.keyCode,new Array(9,13,16,33,34,35,36,38,40))>-1){return true;}search=$.trim(input.val().toLowerCase());clearSearchTimer();timer=setTimeout(searching,settings.latency);});input.keydown(function(e){if(e.shiftKey||e.ctrlKey||e.altKey){return;}switch(e.keyCode){case 9:disable(e);moveTab(self,e.shiftKey?-1:1);break;case 13:disable(e);self.focus();break;case 27:disable(e,true);self.focus();break;case 33:if(selectorHelper.selectedIndex()-selector.attr("size")>0){selectorHelper.selectedIndex(selectorHelper.selectedIndex()-=selector.attr("size"));}else{selectorHelper.selectedIndex(0);}synchronize();break;case 34:if(selectorHelper.selectedIndex()+selector.attr("size")<selector.get(0).options.length-1){selectorHelper.selectedIndex(selectorHelper.selectedIndex()+=selector.attr("size"));}else{selectorHelper.selectedIndex(selector.get(0).options.length-1);}synchronize();break;case 38:if(selectorHelper.selectedIndex()>0){selectorHelper.selectedIndex(selectorHelper.selectedIndex()-1);synchronize();}break;case 40:if(selectorHelper.selectedIndex()<selector.get(0).options.length-1){selectorHelper.selectedIndex(selectorHelper.selectedIndex()+1);synchronize();}break;default:return true;}return false;});function draw(){self.css("text-decoration","none");self.width(self.outerWidth());self.height(self.outerHeight());wrapper.css("position","relative");wrapper.css("width",self.outerWidth());if($.browser.msie){wrapper.css("z-index",zindex);}overlay.css({"position":"absolute","top":0,"left":0,"width":self.outerWidth(),"height":self.outerHeight(),"background-color":"#FFFFFF","opacity":"0.01"});input.attr("type","text");input.hide();input.height(self.outerHeight());input.css({"position":"absolute","top":0,"left":0,"margin":"0px","padding":"0px","outline-style":"none","border-style":"solid","border-bottom-style":"none","border-color":"transparent","background-color":"transparent"});var sty=new Array();sty.push("border-left-width");sty.push("border-top-width");sty.push("font-size");sty.push("font-stretch");sty.push("font-variant");sty.push("font-weight");sty.push("color");sty.push("text-align");sty.push("text-indent");sty.push("text-shadow");sty.push("text-transform");sty.push("padding-left");sty.push("padding-top");for(var i=0;i<sty.length;i++){input.css(sty[i],self.css(sty[i]));}if($.browser.msie&&parseInt(jQuery.browser.version)<8){input.css("padding","0px");input.css("padding-left","3px");input.css("border-left-width","2px");input.css("border-top-width","3px");}else{if($.browser.chrome){input.height(self.innerHeight());input.css("text-transform","none");input.css("padding-left",parseFloatPx(input.css("padding-left"))+3);input.css("padding-top",2);}else{if($.browser.safari){input.height(self.innerHeight());input.css("padding-top",2);input.css("padding-left",3);input.css("text-transform","none");}else{if($.browser.opera){input.height(self.innerHeight());var pl=parseFloatPx(self.css("padding-left"));input.css("padding-left",pl==1?pl+1:pl);input.css("padding-top",0);}else{if($.browser.mozilla){input.css("padding-top","0px");input.css("border-top","0px");input.css("padding-left",parseFloatPx(self.css("padding-left"))+3);}else{input.css("padding-left",parseFloatPx(self.css("padding-left"))+3);input.css("padding-top",parseFloatPx(self.css("padding-top"))+1);}}}}}var offset=parseFloatPx(self.css("padding-left"))+parseFloatPx(self.css("padding-right"))+parseFloatPx(self.css("border-left-width"))+parseFloatPx(self.css("border-left-width"))+23;input.width(self.outerWidth()-offset);var w=self.css("width");var ow=self.outerWidth();self.css("width","auto");var ow=ow>self.outerWidth()?ow:self.outerWidth();self.css("width",w);selector.hide();selectorHelper.size(self.get(0).length);selector.css({"position":"absolute","top":self.outerHeight(),"left":0,"width":ow,"border":"1px solid #333","font-weight":"normal","padding":0,"background-color":self.css("background-color"),"text-transform":self.css("text-transform")});var zIndex=/^\d+$/.test(self.css("z-index"))?self.css("z-index"):1;if(settings.zIndex&&/^\d+$/.test(settings.zIndex)){zIndex=settings.zIndex;}overlay.css("z-index",(zIndex).toString(10));input.css("z-index",(zIndex+1).toString(10));selector.css("z-index",(zIndex+2).toString(10));self.wrap(wrapper);self.after(overlay);self.after(input);self.after(selector);}function enable(e,s,v){if(self.attr("disabled")){return false;}self.prepend("<option />");if(typeof v=="undefined"){enabled=!enabled;}selectorHelper.reset();synchronize();store();if(s){selector.show();}input.show();input.focus();input.select();self.get(0).selectedIndex=0;if(typeof e!="undefined"){e.stopPropagation();}}function disable(e,rs){enabled=false;self.find(":first").remove();clearSearchTimer();input.hide();selector.hide();if(typeof rs!="undefined"){restore();}populate();if(typeof e!="undefined"){e.stopPropagation();}}function clearSearchTimer(){if(timer!=null){clearTimeout(timer);}}function populate(){if(selectorHelper.selectedIndex()<0||selectorHelper.selected().get(0).disabled){return;}self.get(0).selectedIndex=parseInt(selector.find(":selected").attr(idxAttr));self.change();self.data("index",new Number(self.get(0).selectedIndex));}function synchronize(){if(selectorHelper.selectedIndex()>-1&&!selectorHelper.selected().get(0).disabled){input.val(selector.find(":selected").text());}else{input.val(self.find(":selected").text());}}function store(){storage.index=selectorHelper.selectedIndex();storage.options=new Array();for(var i=0;i<selector.get(0).options.length;i++){storage.options.push(selector.get(0).options[i]);}}function restore(){selector.empty();for(var i=0;i<storage.options.length;i++){selector.append(storage.options[i]);}selectorHelper.selectedIndex(storage.index);selectorHelper.size(storage.options.length);}function moveTab(jqe,steps){var fields=jqe.parents("form,body").eq(0).find("button,input[type!=hidden],textarea,select");var index=fields.index(jqe);if(index>-1&&index+steps<fields.length&&index+steps>=0){fields.eq(index+steps).focus();return true;}return false;}function escapeRegExp(str){var specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\","^","$"];var regexp=new RegExp("(\\"+specials.join("|\\")+")","g");return str.replace(regexp,"\\$1");}var timer=null;var searchCache;var search;function searching(){if(searchCache==search){timer=null;return;}var matches=0;searchCache=search;selector.hide();selector.empty();var regexp=escapeRegExp(search);if(settings.exactMatch){regexp="^"+regexp;}if(settings.wildcards){regexp=regexp.replace(/\\\*/g,".*");regexp=regexp.replace(/\\\?/g,".");}var flags;if(settings.ignoreCase){flags="i";}search=new RegExp(regexp,flags);for(var i=1;i<self.get(0).length&&matches<settings.maxMultiMatch;i++){if(search.length==0||search.test(self.get(0).options[i].text)){var opt=$(self.get(0).options[i]).clone().attr(idxAttr,i-1);if(self.data("index")==i){opt.text(self.data("text"));}selector.append(opt);matches++;}}if(matches>=1){selectorHelper.selectedIndex(0);}else{if(matches==0){selector.append(noMatchItem);}}if(matches>=settings.maxMultiMatch){selector.append(topMatchItem);}selectorHelper.size(matches);selector.show();timer=null;}function parseFloatPx(value){try{value=parseFloat(value.replace(/[\s]*px/,""));if(!isNaN(value)){return value;}}catch(e){}return 0;}return;};function register(nsp){var plugin=$[nsp]={};$.fn[nsp]=function(settings){settings=$.extend(plugin.defaults,settings);var elmSize=this.size();return this.each(function(index){plugin.execute.call(this,settings,elmSize-index);});};return plugin;}})(jQuery);