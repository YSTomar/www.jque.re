(function(a){var b=a("html");var c=function(a,b){if(!a.hasClass(".inner")){a=a.children(".inner")}if(b==="y"){return a.children().outerHeight()-a.height()}else{return a.children().outerWidth()-a.width()}};var e=function(a,b,c){return Math.min(Math.max(a,b),c)};var f=function(b,d,f){d=a.extend({speed:400,handle:true},d||{});var g={};if(typeof d.x!=="undefined"){var h=c(b,"x");if(typeof d.x==="string"){d.x=parseFloat(d.x,10);g.x=d.x/h}else{g.x=d.x;d.x=e(d.x,0,1)*h}b.data("scrollX",g.x)}else{d.x=b.children(".inner").scrollLeft()}if(typeof d.y!=="undefined"){var i=c(b,"y");if(typeof d.y==="string"){d.y=parseFloat(d.y,10);g.y=d.y/i}else{g.y=d.y;d.y=e(d.y,0,1)*i}b.data("scrollY",g.y)}else{d.y=b.children(".inner").scrollTop()}b.children(".inner").stop().scrollTo({top:d.y,left:d.x},d.speed,f.easing);if(d.handle){if(typeof g.y!=="undefined"){var j=b.children(".jscrollbar.y");if(j.length>0){yBar=j.children(".bar");yHandle=yBar.children(".handle");yHeight=yBar.outerHeight()-yHandle.outerHeight();yHandle.stop().animate({top:yHeight*e(g.y,0,1)},d.speed,f.easing)}}if(typeof g.x!=="undefined"){var k=b.children(".jscrollbar.x");if(k.length>0){xBar=k.children(".bar");xHandle=xBar.children(".handle");xHeight=xBar.outerWidth()-xHandle.outerWidth();xHandle.stop().animate({left:xHeight*e(g.x,0,1)},d.speed,f.easing)}}}};var g=function(g,h){var i=function(b){h=a.extend(h,b||{});return h};var j=function(){d=h.scrollDirection;h.scrollableX=false;h.scrollableY=false;if(p.children().width()>g.width()){h.scrollableX=true}if(p.children().height()>g.height()){h.scrollableY=true}if(d==="x"){h.scrollX=true}if(d==="y"){h.scrollY=true}if(d==="both"||d==="xy"||d==="yx"||d==="auto"){h.scrollX=true;h.scrollY=true}if(!h.scrollableX&&typeof q!=="undefined"){q.addClass("hide");q.width(0)}if(!h.scrollableY&&typeof t!=="undefined"){t.addClass("hide");t.height(0)}};var k=function(a){if(!h.refreshing){h.refreshing=true;var b={elem:{width:g.width(),height:g.height()},innerChild:{width:p.children().width(),height:p.children().height()}};if(a!==true){var c=g.data("size");if(typeof c!=="undefined"){var d=true;if(b.elem.width!==c.elem.width){d=false}if(b.elem.height!==c.elem.height){d=false}if(b.innerChild.width!==c.innerChild.width){d=false}if(b.innerChild.height!==c.innerChild.height){d=false}if(d){h.refreshing=false;return}}}j();if(h.scrollX&&h.scrollableX){q.removeClass("hide").width("100%")}if(h.scrollY&&h.scrollableY){t.removeClass("hide").height("100%")}if(h.scrollBarAround){p.height(g.height()-(typeof q!=="undefined"?q.height():0));p.width(g.width()-(typeof t!=="undefined"?t.width():0))}if(h.scrollX){if(h.scrollY){q.width(q.width()-t.width()+(h.scrollableY?h.doubleDelta:0))}sbXWidth=q.width()-q.find(".left").width()-q.find(".right").width();r.width(sbXWidth);shWidth=Math.round(p.width()/p.children().width()*sbXWidth);s.width(Math.max(shWidth,2))}if(h.scrollY){if(h.scrollX){t.height(t.height()-q.height()+(h.scrollableX?h.doubleDelta:0))}sbYHeight=t.height()-t.find(".up").height()-t.find(".down").height();u.height(sbYHeight);shHeight=Math.round(p.height()/p.children().height()*sbYHeight);v.height(Math.max(shHeight,2))}f(g,{speed:200,x:p.scrollLeft()+"px",y:p.scrollTop()+"px",handle:true},h);h.refreshing=false}};var l=function(b){var c=a(this);var d=1;if(c.hasClass("up")||c.hasClass("left")){d=-1}if(c.hasClass("down")||c.hasClass("up")){var i=typeof h.arrowScrollY==="string"?"string":"number";if(i==="string"){y=p.scrollTop()+d*parseFloat(h.arrowScrollY,10)+"px"}else{if(i==="number"){y=e(g.data("scrollY")+d*h.arrowScrollY,0,1)}}f(g,{y:y,speed:200},h)}if(c.hasClass("left")||c.hasClass("right")){var i=typeof h.arrowScrollX==="string"?"string":"number";if(i==="string"){x=p.scrollLeft()+d*parseFloat(h.arrowScrollX,10)+"px"}else{if(i==="number"){x=e(g.data("scrollX")+d*h.arrowScrollX,0,1)}}f(g,{x:x,speed:200},h)}};var m=function(d){d.preventDefault();o=true;var i={x:d.screenX,y:d.screenY};var j=i;var k=a(this);var l=k.parent();var m=k.hasClass("x")?"x":"y";if(m==="y"){var q=l.outerHeight();var r=k.outerHeight();var s=q-r;var t=g.data("scrollY")}else{var u=l.outerWidth();var v=k.outerWidth();var s=u-v;var t=g.data("scrollX")}var w=t*s;var x=c(p,m);var y=0;b.bind("mousemove",function(a){a.preventDefault();var b={x:a.screenX,y:a.screenY};var c={x:b.x-j.x,y:b.y-j.y};if(m==="y"){w+=c.y}else{w+=c.x}aDelta=e(w,0,s);k.css(m==="y"?"top":"left",aDelta+"px");y=aDelta/s;var d={speed:0,handle:false};if(m==="y"){d.y=y}else{d.x=y}f(g,d,h);j=b});b.bind("mouseup",function(a){b.unbind("mouseup").unbind("mousemove");o=false;if(!n){g.trigger("mouseleave")}})};this.refresh=function(){k()};this.scrollTo=function(a){f(g,a,h)};this.setOptions=function(a){i(a)};h=a.extend({scrollDirection:"auto",scrollTop:0,scrollLeft:0,arrowScroll:0.1,wheelScroll:0.2,switchWheelY:true,easing:"swing",doubleDelta:2,scrollBarAround:true,showScrollBarOnHover:false,refreshIncrement:5000,theme:""},h||{});if(typeof h.arrowScrollX==="undefined"){h.arrowScrollX=h.arrowScroll}if(typeof h.arrowScrollY==="undefined"){h.arrowScrollY=h.arrowScroll}if(typeof h.wheelScrollX==="undefined"){h.wheelScrollX=h.wheelScroll}if(typeof h.wheelScrollY==="undefined"){h.wheelScrollY=h.wheelScroll}delete h.arrowScroll;delete h.wheelScroll;h.scrollX=false;h.scrollY=false;h.lastWheel={timestamp:(new Date).getTime(),deltaX:0,deltaY:0};var n=false;var o=false;g.addClass("jscroller elem").addClass(h.theme);var p=g.wrapInner('<div class="inner"/>').children(".inner");j();if(h.scrollX&&h.scrollY){g.addClass("scrollboth")}if(h.scrollX){g.addClass("scrollx")}if(h.scrollY){g.addClass("scrolly")}if(h.scrollX){var q=g.append('<div class="jscrollbar x" />').find(".jscrollbar.x");q.append('<div class="arrow left"/>').append('<div class="bar x"><div class="handle x"/></div>').append('<div class="arrow right"/>');var r=q.find(".bar");var s=q.find(".handle");if(!h.scrollableX){q.addClass("hide")}}if(h.scrollY){var t=g.append('<div class="jscrollbar y" />').find(".jscrollbar.y");t.append('<div class="arrow up"/>').append('<div class="bar y"><div class="handle y"/></div>').append('<div class="arrow down"/>');var u=t.find(".bar");var v=t.find(".handle");if(!h.scrollableY){t.addClass("hide")}}k();f(g,{y:h.scrollTop,x:h.scrollLeft,speed:400},h);setInterval(k,h.refreshIncrement);g.hover(function(a){n=true},function(a){n=false});if(h.showScrollBarOnHover){g.hover(function(b){a(".jscrollbar",g).stop().fadeTo(300,1)},function(b){if(!o){a(".jscrollbar",g).stop().fadeTo(300,0)}})}g.bind("mousewheel",function(a,b,c,d){a.preventDefault();if(h.scrollableX&&!h.scrollableY&&h.switchWheelY){c=d;d=0}if(!h.scrollableX&&!h.scrollableY){return}if(typeof h.wheelScrollX==="string"){x=p.scrollLeft()-c*parseFloat(h.wheelScrollX,10)+"px"}else{x=e(g.data("scrollX")-c*h.wheelScrollX,0,1)}if(typeof h.wheelScrollY==="string"){y=p.scrollTop()-d*parseFloat(h.wheelScrollY,10)+"px"}else{y=e(g.data("scrollY")-d*h.wheelScrollY,0,1)}f(g,{x:x,y:y,speed:200},h)});if(h.scrollX){q.find(".arrow").click(l);s.bind("mousedown",m)}if(h.scrollY){t.find(".arrow").click(l);v.bind("mousedown",m)}};a.fn.jScroller=function(b,c){return this.each(function(){var d=a(this);var e=this;var f=d.data("jScroller");if(f){if(b==="refresh"){f.refresh()}else{if(b==="scrollTo"){f.scrollTo(c)}else{if(b==="option"){f.setOptions(c)}}}return}var h=new g(d,b);d.data("jScroller",h)})}})(jQuery);