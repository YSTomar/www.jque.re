(function($){$.scrollorama=function(options){var blocks=[],browserPrefix="",onBlockChange=function(){};var scrollorama=this;var defaults={offset:0};scrollorama.settings=$.extend({},defaults,options);scrollorama.blockIndex=0;if(options.blocks===undefined){alert("ERROR: Must assign blocks class selector to scrollorama plugin")}function init(){if(typeof scrollorama.settings.blocks==="string"){scrollorama.settings.blocks=$(scrollorama.settings.blocks)}if($.browser.mozilla){browserPrefix="-moz-"}if($.browser.webkit){browserPrefix="-webkit-"}if($.browser.opera){browserPrefix="-o-"}if($.browser.msie){browserPrefix="-ms-"}$("body").css("position","relative");var i;for(i=0;i<scrollorama.settings.blocks.length;i++){var block=scrollorama.settings.blocks.eq(i);blocks.push({block:block,top:block.offset().top,pin:0,animations:[]})}for(i=0;i<blocks.length;i++){blocks[i].block.css("position","absolute").css("top",blocks[i].top)}$("body").prepend("<div id='scroll-wrap'></div>");var didScroll=false;$(window).scroll(function(){didScroll=true});setInterval(function(){if(didScroll){onScrollorama();didScroll=false}},50)}function onScrollorama(){var scrollTop=$(window).scrollTop();var currBlockIndex=getCurrBlockIndex(scrollTop);for(var i=0;i<blocks.length;i++){if(blocks[i].animations.length){for(var j=0;j<blocks[i].animations.length;j++){var anim=blocks[i].animations[j];if(i>currBlockIndex){if(currBlockIndex!=i-1&&anim.baseline!="bottom"){setProperty(anim.element,anim.property,anim.startVal)}if(blocks[i].pin){blocks[i].block.css("position","absolute").css("top",blocks[i].top)}}else{if(i<currBlockIndex){setProperty(anim.element,anim.property,anim.endVal);if(blocks[i].pin){blocks[i].block.css("position","absolute").css("top",(blocks[i].top+blocks[i].pin))}}}if(i==currBlockIndex||(currBlockIndex==i-1&&anim.baseline=="bottom")){if(blocks[i].pin&&currBlockIndex==i){blocks[i].block.css("position","fixed").css("top",0)}var startAnimPos=blocks[i].top+anim.delay;if(anim.baseline=="bottom"){startAnimPos-=$(window).height()}var endAnimPos=startAnimPos+anim.duration;if(scrollTop<startAnimPos){setProperty(anim.element,anim.property,anim.startVal)}else{if(scrollTop>endAnimPos){setProperty(anim.element,anim.property,anim.endVal);if(blocks[i].pin){blocks[i].block.css("position","absolute").css("top",(blocks[i].top+blocks[i].pin))}}else{var animPercent=(scrollTop-startAnimPos)/anim.duration;var animVal=anim.startVal+(animPercent*(anim.endVal-anim.startVal));setProperty(anim.element,anim.property,animVal)}}}}}}if(scrollorama.blockIndex!=currBlockIndex){scrollorama.blockIndex=currBlockIndex;onBlockChange()}}function getCurrBlockIndex(scrollTop){var currBlockIndex=0;for(var i=0;i<blocks.length;i++){if(blocks[i].top<=scrollTop-scrollorama.settings.offset){currBlockIndex=i}}return currBlockIndex}function setProperty(target,prop,val){if(prop==="rotate"||prop==="zoom"||prop==="scale"){if(prop==="rotate"){target.css(browserPrefix+"transform","rotate("+val+"deg)")}else{if(prop==="zoom"||prop==="scale"){var scaleCSS="scale("+val+")";if(browserPrefix!=="-ms-"){target.css(browserPrefix+"transform",scaleCSS)}else{target.css("zoom",scaleCSS)}}}}else{target.css(prop,val)}}scrollorama.animate=function(target){if(typeof target==="string"){target=$(target)}var targetIndex;var targetBlock;for(var i=0;i<blocks.length;i++){if(blocks[i].block.has(target).length){targetBlock=blocks[i];targetIndex=i}}for(i=1;i<arguments.length;i++){var anim=arguments[i];if(anim.property=="top"||anim.property=="left"||anim.property=="bottom"||anim.property=="right"){if(target.css("position")=="static"){target.css("position","relative")}if(anim.start===undefined){anim.start=0}else{if(anim.end===undefined){anim.end=0}}}if(anim.property=="rotate"){if(anim.start===undefined){anim.start=0}if(anim.end===undefined){anim.end=0}}else{if(anim.property=="zoom"||anim.property=="scale"){if(anim.start===undefined){anim.start=1}if(anim.end===undefined){anim.end=1}}else{if(anim.property=="letter-spacing"&&target.css(anim.property)){if(anim.start===undefined){anim.start=1}if(anim.end===undefined){anim.end=1}}}}if(anim.baseline===undefined){if(anim.pin||targetBlock.pin||targetIndex===0){anim.baseline="top"}else{anim.baseline="bottom"}}if(anim.delay===undefined){anim.delay=0}targetBlock.animations.push({element:target,delay:anim.delay,duration:anim.duration,property:anim.property,startVal:anim.start!==undefined?anim.start:parseInt(target.css(anim.property),10),endVal:anim.end!==undefined?anim.end:parseInt(target.css(anim.property),10),baseline:anim.baseline!==undefined?anim.baseline:"bottom"});if(anim.pin){if(targetBlock.pin<anim.duration+anim.delay){var offset=anim.duration+anim.delay-targetBlock.pin;targetBlock.pin+=offset;for(var j=targetIndex+1;j<blocks.length;j++){blocks[j].top+=offset;blocks[j].block.css("top",blocks[j].top)}}}}onScrollorama()};scrollorama.onBlockChange=function(f){onBlockChange=f};scrollorama.getScrollpoints=function(){var scrollpoints=[];for(var i=0;i<blocks.length;i++){scrollpoints.push(blocks[i].top);if(blocks[i].animations.length&&blocks[i].pin>0){for(var j=0;j<blocks[i].animations.length;j++){var anim=blocks[i].animations[j];scrollpoints.push(blocks[i].top+anim.delay+anim.duration)}}}scrollpoints.sort(function(a,b){return a-b});return scrollpoints};init();return scrollorama}})(jQuery);