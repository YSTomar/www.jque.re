(function($,undefined){$.widget("cc.sausage",{options:{page:".page",content:function(i,$page){return'<span class="sausage-span">'+(i+1)+"</span>"}},_create:function(){var self=this,$el=self.element;self.$outer=$el;self.$inner=$.isWindow(self.element.get(0))?$("body"):$el.children(":first-child");self.$sausages=$('<div class="sausage-set"/>');self.sausages=self.$sausages.get(0);self.offsets=[];self.$sausages.appendTo(self.$inner);self._trigger("create");return},_init:function(){var self=this;if(self.$outer.height()>=self.$inner.height()){self.destroy();return}self.draw();self._update();self._events();self._delegates();self.$sausages.addClass("sausage-set-init");self.blocked=false;self._trigger("init");return},_events:function(){var self=this;self.hasScrolled=false;self.$outer.bind("resize.sausage",function(){self.draw()}).bind("scroll.sausage",function(e){self.hasScrolled=true});setInterval(function(){if(!self.hasScrolled){return}self.hasScrolled=false;self._update()},250);return},_getCurrent:function(){var self=this,st=self.$outer.scrollTop()+self._getHandleHeight(self.$outer,self.$inner)/4,h_win=self.$outer.height(),h_doc=self.$inner.height(),i=0;for(l=self.offsets.length;i<l;i++){if(!self.offsets[i+1]){return i}else{if(st<=self.offsets[i]){return i}else{if(st>self.offsets[i]&&st<=self.offsets[i+1]){return i}}}}return i},_delegates:function(){var self=this;self.$sausages.delegate(".sausage","hover",function(){if(self.blocked){return}$(this).toggleClass("sausage-hover")}).delegate(".sausage","click",function(e){e.preventDefault();if(self.blocked){return}var $sausage=$(this),val=$sausage.index(),o=self.$inner.find(self.options.page).eq(val).offset().top;self._scrollTo(o);self._trigger("onClick",e,{$sausage:$sausage,i:val});if($sausage.hasClass("current")){return}self._trigger("onUpdate",e,{$sausage:$sausage,i:val})});return},_scrollTo:function(o){var self=this,$outer=self.$outer,rate=2/1,distance=self.offsets[self.current]-o,duration=Math.abs(distance/rate);duration=(duration<1000)?duration:1000;if(self.$outer.get(0)===window){$outer=$("html, document")}$outer.stop(true).animate({scrollTop:o},duration);return},_handleClick:function(){var self=this;return},_update:function(){var self=this;i=self._getCurrent(),c="sausage-current";if(i===self.current||self.blocked){return}self.current=i;self.$sausages.children().eq(i).addClass(c).siblings().removeClass(c);self._trigger("update");return},_getHandleHeight:function($outer,$inner){var h_outer=$outer.height(),h_inner=$inner.height();return h_outer/h_inner*h_outer},draw:function(){var self=this,h_win=self.$outer.height(),h_doc=self.$inner.height(),$items=self.$inner.find(self.options.page),$page,s=[],offset_p,offset_s;self.offsets=[];self.count=$items.length;self.$sausages.detach().empty();for(var i=0;i<self.count;i++){$page=$items.eq(i);offset_p=$page.offset();offset_s=offset_p.top/h_doc*h_win;s.push('<div class="sausage'+((i===self.current)?" sausage-current":"")+'" style="height:'+($page.outerHeight()/h_doc*h_win)+"px;top:"+offset_s+'px;">'+self.options.content(i,$page)+"</div>");self.offsets.push(offset_p.top)}self.sausages.innerHTML=s.join("");self.$sausages.appendTo(self.$inner);return},block:function(){var self=this,c="sausage-set-blocked";self.blocked=true;self.$sausages.addClass(c);return},unblock:function(){var self=this,c="sausage-set-blocked";self.$sausages.removeClass(c);self.blocked=false;return},destroy:function(){var self=this;self.$outer.unbind(".sausage");self.$sausages.remove();return}})})(jQuery);